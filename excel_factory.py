# poliza_actual_cuadro
poliza_actual = [
    {"Interés Asegurado": "Edificios", "Valor Asegurado": 22615066519},
    {"Interés Asegurado": "Equipo Electrónico", "Valor Asegurado": 1204502680},
    {"Interés Asegurado": "Muebles y Enseres", "Valor Asegurado": 1621213188},
    {"Interés Asegurado": "Maquinaria y Equipo", "Valor Asegurado": 2928485866},
    {"Interés Asegurado": "Mercancías", "Valor Asegurado": 46200000},
    {"Interés Asegurado": "Dinero", "Valor Asegurado": 196000000},
    {"Interés Asegurado": "Eq. Móviles y Portátiles", "Valor Asegurado": 82695800},
]
# poliza_renovacion_cuadro
poliza_renovacion = [
    {"Interés Asegurado": "Edificios", "Valor Asegurado": 24876573170},
    {"Interés Asegurado": "Equipo Electrónico", "Valor Asegurado": 1245453104},
    {"Interés Asegurado": "Muebles y Enseres", "Valor Asegurado": 1783334507},
    {"Interés Asegurado": "Maquinaria y Equipo", "Valor Asegurado": 3221334452},
    {"Interés Asegurado": "Mercancías", "Valor Asegurado": 46200000},
    {"Interés Asegurado": "Dinero", "Valor Asegurado": 196000000},
    {"Interés Asegurado": "Eq. Móviles y Portátiles", "Valor Asegurado": 94156337},
]
# docs_adicionales_data - NO LO USAMOS
docs_adicionales_data = [
    {
        "Archivo": "Slip Cotización 2500004260 Pyme Segura 10+ (1).pdf",
        "Prima Sin IVA": 6093640,
        "IVA": 1157792,
        "Prima Con IVA": 7251432,
    },
    {
        "Archivo": "SLIP TRDM OFICINAS_CAMARA DE COMERCIO.pdf",
        "Prima Sin IVA": 28289403,
        "IVA": 0,
        "Prima Con IVA": 28289403,
    },
]
# riesgos_actuales
riesgos_actuales = [
    {
        "ubicacion": "1 Calle 28 # 30-15 PALMIRA",
        "detalle_cobertura": [
            {
                "interes_asegurado": "EDIFICIO",
                "valor_asegurado": 3061592832,
                "tipo": ["Incendio"],
            },
            {
                "interes_asegurado": "MAQUINARIA Y EQUIPO",
                "valor_asegurado": 141240000,
                "tipo": ["Equipo y Maquinaria"],
            },
            {
                "interes_asegurado": "EQUIPO ELECTRICO Y ELECTRONICO",
                "valor_asegurado": 58850000,
                "tipo": ["Equipo y Maquinaria"],
            },
        ],
    },
    {
        "ubicacion": "2 Carrera 18 #8-31 FLORIDA",
        "detalle_cobertura": [
            {
                "interes_asegurado": "EDIFICIO",
                "valor_asegurado": 505019752,
                "tipo": ["Incendio"],
            },
            {
                "interes_asegurado": "MUEBLES Y ENSERES",
                "valor_asegurado": 100145560,
                "tipo": ["Incendio"],
            },
            {
                "interes_asegurado": "MAQUINARIA Y EQUIPO",
                "valor_asegurado": 77255146,
                "tipo": ["Equipo y Maquinaria"],
            },
            {
                "interes_asegurado": "EQUIPO ELECTRICO Y ELECTRONICO",
                "valor_asegurado": 59352677,
                "tipo": ["Equipo y Maquinaria"],
            },
            {
                "interes_asegurado": "MERCANCIAS",
                "valor_asegurado": 11000000,
                "tipo": ["Incendio"],
            },
            {
                "interes_asegurado": "DINEROS",
                "valor_asegurado": 22000000,
                "tipo": ["Manejo de Dinero", "Transporte de Valores"],
            },
        ],
    },
    {
        "ubicacion": "3 Calle 6 # 12-50 PRADERA",
        "detalle_cobertura": [
            {
                "interes_asegurado": "EDIFICIO",
                "valor_asegurado": 586566851,
                "tipo": ["Incendio"],
            },
            {
                "interes_asegurado": "MUEBLES Y ENSERES",
                "valor_asegurado": 123035974,
                "tipo": ["Incendio"],
            },
            {
                "interes_asegurado": "MAQUINARIA Y EQUIPO",
                "valor_asegurado": 77255146,
                "tipo": ["Equipo y Maquinaria"],
            },
            {
                "interes_asegurado": "EQUIPO ELECTRICO Y ELECTRONICO",
                "valor_asegurado": 55386331,
                "tipo": ["Equipo y Maquinaria"],
            },
            {
                "interes_asegurado": "MERCANCIAS",
                "valor_asegurado": 11000000,
                "tipo": ["Incendio"],
            },
            {
                "interes_asegurado": "DINEROS",
                "valor_asegurado": 22000000,
                "tipo": ["Manejo de Dinero", "Transporte de Valores"],
            },
        ],
    },
    {
        "ubicacion": "4 Carrera 7 #. 11-56 CANDELARIA",
        "detalle_cobertura": [
            {
                "interes_asegurado": "EDIFICIO",
                "valor_asegurado": 806887083,
                "tipo": ["Incendio"],
            },
            {
                "interes_asegurado": "MUEBLES Y ENSERES",
                "valor_asegurado": 91561655,
                "tipo": ["Incendio"],
            },
            {
                "interes_asegurado": "MAQUINARIA Y EQUIPO",
                "valor_asegurado": 38627573,
                "tipo": ["Equipo y Maquinaria"],
            },
            {
                "interes_asegurado": "EQUIPO ELECTRICO Y ELECTRONICO",
                "valor_asegurado": 46705241,
                "tipo": ["Equipo y Maquinaria"],
            },
            {
                "interes_asegurado": "MERCANCIAS",
                "valor_asegurado": 2200000,
                "tipo": ["Incendio"],
            },
            {
                "interes_asegurado": "DINEROS",
                "valor_asegurado": 22000000,
                "tipo": ["Manejo de Dinero", "Transporte de Valores"],
            },
        ],
    },
    {
        "ubicacion": "5 Carrera 31 # 28-00 y Calle 28 #31-30 Esq PALMIRA",
        "detalle_cobertura": [
            {
                "interes_asegurado": "EDIFICIO",
                "valor_asegurado": 17655000000,
                "tipo": ["Incendio"],
            },
            {
                "interes_asegurado": "MUEBLES Y ENSERES",
                "valor_asegurado": 921591000,
                "tipo": ["Incendio"],
            },
            {
                "interes_asegurado": "OBRAS DE ARTE",
                "valor_asegurado": 384879000,
                "tipo": ["Incendio"],
            },
            {
                "interes_asegurado": "MAQUINARIA Y EQUIPO",
                "valor_asegurado": 2594108000,
                "tipo": ["Equipo y Maquinaria"],
            },
            {
                "interes_asegurado": "EQUIPO ELECTRICO Y ELECTRONICO",
                "valor_asegurado": 977178797,
                "tipo": ["Equipo y Maquinaria"],
            },
            {
                "interes_asegurado": "EQUIPO MOVIL",
                "valor_asegurado": 73562500,
                "tipo": ["Equipo y Maquinaria"],
            },
            {
                "interes_asegurado": "MERCANCIAS",
                "valor_asegurado": 22000000,
                "tipo": ["Incendio"],
            },
            {
                "interes_asegurado": "DINEROS",
                "valor_asegurado": 130000000,
                "tipo": ["Manejo de Dinero", "Transporte de Valores"],
            },
        ],
    },
]
# riesgos_renovacion
riesgos_renovacion = [
    {
        "ubicacion": "Calle 28 # 30-15 PALMIRA",
        "detalle_cobertura": [
            {
                "interes_asegurado": "EDIFICIO",
                "valor_asegurado": 3367752116,
                "tipo": ["Incendio"],
            },
            {
                "interes_asegurado": "MAQUINARIA Y EQUIPO",
                "valor_asegurado": 155364000,
                "tipo": ["Equipo y Maquinaria"],
            },
            {
                "interes_asegurado": "EQUIPO ELECTRICO Y ELECTRONICO",
                "valor_asegurado": 64735000,
                "tipo": ["Equipo y Maquinaria"],
            },
        ],
    },
    {
        "ubicacion": "Carrera 18 # 8-31 FLORIDA",
        "detalle_cobertura": [
            {
                "interes_asegurado": "EDIFICIO",
                "valor_asegurado": 555521727,
                "tipo": ["Incendio"],
            },
            {
                "interes_asegurado": "MUEBLES Y ENSERES",
                "valor_asegurado": 110160116,
                "tipo": ["Incendio"],
            },
            {
                "interes_asegurado": "MAQUINARIA Y EQUIPO",
                "valor_asegurado": 84980661,
                "tipo": ["Equipo y Maquinaria"],
            },
            {
                "interes_asegurado": "EQUIPO ELECTRICO Y ELECTRONICO",
                "valor_asegurado": 69072144,
                "tipo": ["Equipo y Maquinaria"],
            },
            {
                "interes_asegurado": "MERCANCIAS",
                "valor_asegurado": 11000000,
                "tipo": ["Incendio", "Sustracción"],
            },
            {
                "interes_asegurado": "DINEROS",
                "valor_asegurado": 22000000,
                "tipo": ["Manejo de Dinero", "Sustracción", "Transporte de Valores"],
            },
        ],
    },
    {
        "ubicacion": "Calle 6 # 12-50 PRADERA",
        "detalle_cobertura": [
            {
                "interes_asegurado": "EDIFICIO",
                "valor_asegurado": 645223536,
                "tipo": ["Incendio"],
            },
            {
                "interes_asegurado": "MUEBLES Y ENSERES",
                "valor_asegurado": 135339571,
                "tipo": ["Incendio"],
            },
            {
                "interes_asegurado": "MAQUINARIA Y EQUIPO",
                "valor_asegurado": 84980661,
                "tipo": ["Equipo y Maquinaria"],
            },
            {
                "interes_asegurado": "EQUIPO ELECTRICO Y ELECTRONICO",
                "valor_asegurado": 64709165,
                "tipo": ["Equipo y Maquinaria"],
            },
            {
                "interes_asegurado": "MERCANCIAS",
                "valor_asegurado": 11000000,
                "tipo": ["Incendio", "Sustracción"],
            },
            {
                "interes_asegurado": "DINEROS",
                "valor_asegurado": 22000000,
                "tipo": ["Manejo de Dinero", "Sustracción", "Transporte de Valores"],
            },
        ],
    },
    {
        "ubicacion": "Carrera 7 #. 11-56 CANDELARIA",
        "detalle_cobertura": [
            {
                "interes_asegurado": "EDIFICIO",
                "valor_asegurado": 887575791,
                "tipo": ["Incendio"],
            },
            {
                "interes_asegurado": "MUEBLES Y ENSERES",
                "valor_asegurado": 100717820,
                "tipo": ["Incendio"],
            },
            {
                "interes_asegurado": "MAQUINARIA Y EQUIPO",
                "valor_asegurado": 42490330,
                "tipo": ["Equipo y Maquinaria"],
            },
            {
                "interes_asegurado": "EQUIPO ELECTRICO Y ELECTRONICO",
                "valor_asegurado": 55159965,
                "tipo": ["Equipo y Maquinaria"],
            },
            {
                "interes_asegurado": "MERCANCIAS",
                "valor_asegurado": 2200000,
                "tipo": ["Incendio", "Sustracción"],
            },
            {
                "interes_asegurado": "DINEROS",
                "valor_asegurado": 22000000,
                "tipo": ["Manejo de Dinero", "Sustracción", "Transporte de Valores"],
            },
        ],
    },
    {
        "ubicacion": "Carrera 31 # 28-00 y Calle 28 #31-30 Esq PALMIRA",
        "detalle_cobertura": [
            {
                "interes_asegurado": "EDIFICIO",
                "valor_asegurado": 19420500000,
                "tipo": ["Incendio"],
            },
            {
                "interes_asegurado": "MUEBLES Y ENSERES Y OBRAS DE ARTE",
                "valor_asegurado": 1437117000,
                "tipo": ["Incendio"],
            },
            {
                "interes_asegurado": "MAQUINARIA Y EQUIPO",
                "valor_asegurado": 2853518800,
                "tipo": ["Equipo y Maquinaria"],
            },
            {
                "interes_asegurado": "EQUIPO ELECTRICO Y ELECTRONICO",
                "valor_asegurado": 991776830,
                "tipo": ["Equipo y Maquinaria"],
            },
            {
                "interes_asegurado": "EQUIPO MOVIL",
                "valor_asegurado": 94156337,
                "tipo": ["Equipo y Maquinaria"],
            },
            {
                "interes_asegurado": "MERCANCIAS",
                "valor_asegurado": 22000000,
                "tipo": ["Incendio", "Sustracción"],
            },
            {
                "interes_asegurado": "DINEROS",
                "valor_asegurado": 130000000,
                "tipo": ["Manejo de Dinero", "Sustracción", "Transporte de Valores"],
            },
        ],
    },
]
# amparos_actuales
amparos_actuales = {
    "archivo": "POLIZA ACTUAL EMPRESARIAL 128663630-0 CAMARA DE COMERCIO DE PALMIRA 2024-2025.pdf",
    "amparos": [
        {
            "amparo": "Incendio y/o Impacto Directo De Rayo",
            "deducible": "5% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Explosión",
            "deducible": "5% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Extensión de Amparos",
            "deducible": "5% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Explosión de Calderas u Otros Aparatos Generadores de Vapor",
            "deducible": "5% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Incendio", "Equipo y Maquinaria"],
        },
        {
            "amparo": "Rotura Accidental De Vidrios",
            "deducible": "0,25 SMMLV",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Terremoto, Temblor De Tierra, Erupción Volcánica, Tsunami, Maremoto",
            "deducible": "2% del valor asegurable del artículo mínimo 1 SMMLV",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Anegación",
            "deducible": "5% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Daños Por Agua",
            "deducible": "5% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "AMIT Y Terrorismo",
            "deducible": "5% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "HMACC",
            "deducible": "5% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Productos Almacenados En Frigoríficos",
            "deducible": "10% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Daño Interno Equipos Eléctricos Y Electrónicos",
            "deducible": "10% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Equipo y Maquinaria"],
        },
        {
            "amparo": "Portadores Externos de Datos",
            "deducible": "10% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Equipo y Maquinaria"],
        },
        {
            "amparo": "Equipos Móviles Y Portátiles",
            "deducible": "10% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Equipo y Maquinaria", "Sustracción"],
        },
        {
            "amparo": "Incremento en Costos De Operación",
            "deducible": "10% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Daños por Fallas En Equipos De Climatización",
            "deducible": "10% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Equipo y Maquinaria"],
        },
        {
            "amparo": "Rotura De Maquinaria",
            "deducible": "10% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Equipo y Maquinaria"],
        },
        {
            "amparo": "Pérdida de Contenido en Tanques",
            "deducible": "10% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Deterioro de Bienes Refrigerados",
            "deducible": "10% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Hurto Calificado",
            "deducible": "10% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Sustracción"],
        },
        {
            "amparo": "Hurto Simple para Equipo Eléctrico Y Electrónico Fijo de Oficina",
            "deducible": "10% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Sustracción", "Equipo y Maquinaria"],
        },
        {
            "amparo": "Bienes de Propiedad de Empleados del Asegurado",
            "deducible": "5% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Sustracción"],
        },
        {
            "amparo": "Traslado Temporal de Bienes",
            "deducible": "5% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Sustracción"],
        },
        {
            "amparo": "Construcciones y Montajes Nuevos",
            "deducible": "5% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Bienes a la Intemperie",
            "deducible": "5% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Actos de Autoridad",
            "deducible": "5% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Remoción de Escombros",
            "deducible": "Aplica el de la cobertura afectada",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Honorarios de Profesionales como Arquitectos, Interventores, Ingenieros y Consultores",
            "deducible": "Aplica el de la cobertura afectada",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Gastos para la Preservación de Bienes",
            "deducible": "Aplica el de la cobertura afectada",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Gastos para la Reproducción y/o Reemplazo de la Información",
            "deducible": "Aplica el de la cobertura afectada",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Gastos para Demostrar la Pérdida",
            "deducible": "Aplica el de la cobertura afectada",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Transporte De Valores",
            "deducible": "5% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Transporte de Valores"],
        },
        {
            "amparo": "Gastos de Extinción del siniestro",
            "deducible": "Aplica el de la cobertura afectada",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Daños o pérdidas de Mercancías a Granel",
            "deducible": "5% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Manejo",
            "deducible": "10% del valor de la pérdida mínimo 2 SMMLV",
            "tipo": ["Manejo de Dinero", "Sustracción"],
        },
        {
            "amparo": "Empleados de Carácter Temporal y/o de Firmas Especializadas",
            "deducible": "10% del valor de la pérdida mínimo 2 SMMLV",
            "tipo": ["Manejo de Dinero", "Sustracción"],
        },
        {
            "amparo": "Empleados no Identificados",
            "deducible": "10% del valor de la pérdida mínimo 2 SMMLV",
            "tipo": ["Manejo de Dinero", "Sustracción"],
        },
        {
            "amparo": "Bienes de Propiedad de Terceros",
            "deducible": "10% del valor de la pérdida mínimo 2 SMMLV",
            "tipo": ["Manejo de Dinero", "Sustracción"],
        },
        {
            "amparo": "Protección para Depósitos Bancarios",
            "deducible": "10% del valor de la pérdida mínimo 2 SMMLV",
            "tipo": ["Manejo de Dinero", "Sustracción"],
        },
        {
            "amparo": "Predios Labores y Operaciones",
            "deducible": "10% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Responsabilidad Civil"],
        },
        {
            "amparo": "Contratistas y Subcontratistas",
            "deducible": "10% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Responsabilidad Civil"],
        },
        {
            "amparo": "Responsabilidad Civil Patronal",
            "deducible": "10% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Responsabilidad Civil"],
        },
        {
            "amparo": "Vehículos Propios y no Propios",
            "deducible": "En exceso del SOAT y RCE autos mínimo 100.000.000/100.000.000/200.000.000 COP",
            "tipo": ["Responsabilidad Civil"],
        },
        {
            "amparo": "Propietarios, Arrendatarios y Poseedores",
            "deducible": "10% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Responsabilidad Civil"],
        },
        {
            "amparo": "Gastos Médicos",
            "deducible": "No especificado",
            "tipo": ["Responsabilidad Civil"],
        },
        {
            "amparo": "Responsabilidad Civil Cruzada",
            "deducible": "10% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Responsabilidad Civil"],
        },
        {
            "amparo": "Responsabilidad Civil Parqueaderos",
            "deducible": "10% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Responsabilidad Civil"],
        },
    ],
}
# amparos_renovacion
amparos_renovacion = {
    "archivo": "PR336-186756401-26358662 COT CyC PALMIRA.pdf",
    "amparos": [
        {
            "amparo": "Incendio y/o Impacto Directo De Rayo",
            "deducible": "5% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Explosión",
            "deducible": "5% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Extensión de Amparos",
            "deducible": "5% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Explosión de Calderas u Otros Aparatos Generadores de Vapor",
            "deducible": "5% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Rotura Accidental De Vidrios",
            "deducible": "0,25 SMMLV",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Terremoto, Temblor De Tierra, Erupción Volcánica, Tsunami, Maremoto",
            "deducible": "2% del valor asegurable del artículo mínimo 1 SMMLV",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Anegación",
            "deducible": "5% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Daños Por Agua",
            "deducible": "5% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "AMIT Y Terrorismo",
            "deducible": "5% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "HMACC",
            "deducible": "5% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Productos Almacenados En Frigoríficos",
            "deducible": "10% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Incendio", "Equipo y Maquinaria"],
        },
        {
            "amparo": "Daño Interno Equipos Eléctricos Y Electrónicos",
            "deducible": "10% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Equipo y Maquinaria"],
        },
        {
            "amparo": "Portadores Externos de Datos",
            "deducible": "10% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Equipo y Maquinaria"],
        },
        {
            "amparo": "Equipos Móviles Y Portátiles",
            "deducible": "10% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Equipo y Maquinaria"],
        },
        {
            "amparo": "Incremento en Costos De Operación",
            "deducible": "10% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Incendio", "Equipo y Maquinaria"],
        },
        {
            "amparo": "Daños por Fallas En Equipos De Climatización",
            "deducible": "10% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Equipo y Maquinaria"],
        },
        {
            "amparo": "Rotura De Maquinaria",
            "deducible": "10% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Equipo y Maquinaria"],
        },
        {
            "amparo": "Pérdida de Contenido en Tanques",
            "deducible": "10% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Deterioro de Bienes Refrigerados",
            "deducible": "10% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Incendio", "Equipo y Maquinaria"],
        },
        {
            "amparo": "Hurto Calificado",
            "deducible": "10% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Sustracción"],
        },
        {
            "amparo": "Hurto Simple para Equipo Eléctrico Y Electrónico Fijo de Oficina",
            "deducible": "10% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Sustracción", "Equipo y Maquinaria"],
        },
        {
            "amparo": "Bienes de Propiedad de Empleados del Asegurado",
            "deducible": "5% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Sustracción", "Manejo de Dinero"],
        },
        {
            "amparo": "Traslado Temporal de Bienes",
            "deducible": "5% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Sustracción", "Transporte de Valores"],
        },
        {
            "amparo": "Construcciones y Montajes Nuevos",
            "deducible": "5% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Bienes a la Intemperie",
            "deducible": "5% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Actos de Autoridad",
            "deducible": "5% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Remoción de Escombros",
            "deducible": "Aplica el de la cobertura afectada",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Honorarios de Profesionales como Arquitectos, Interventores, Ingenieros y Consultores",
            "deducible": "Aplica el de la cobertura afectada",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Gastos para la Preservación de Bienes",
            "deducible": "Aplica el de la cobertura afectada",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Gastos para la Reproducción y/o Reemplazo de la Información",
            "deducible": "Aplica el de la cobertura afectada",
            "tipo": ["Incendio", "Equipo y Maquinaria"],
        },
        {
            "amparo": "Gastos para Demostrar la Pérdida",
            "deducible": "Aplica el de la cobertura afectada",
            "tipo": ["Incendio"],
        },
        {
            "amparo": "Transporte De Valores",
            "deducible": "5% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Transporte de Valores"],
        },
        {
            "amparo": "Daños o pérdidas de Mercancías a Granel",
            "deducible": "5% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Incendio", "Sustracción"],
        },
        {
            "amparo": "Manejo",
            "deducible": "10% del valor de la pérdida mínimo 2 SMMLV",
            "tipo": ["Manejo de Dinero"],
        },
        {
            "amparo": "Empleados de Carácter Temporal y/o de Firmas Especializadas",
            "deducible": "10% del valor de la pérdida mínimo 2 SMMLV",
            "tipo": ["Manejo de Dinero"],
        },
        {
            "amparo": "Empleados no Identificados",
            "deducible": "10% del valor de la pérdida mínimo 2 SMMLV",
            "tipo": ["Manejo de Dinero"],
        },
        {
            "amparo": "Bienes de Propiedad de Terceros",
            "deducible": "10% del valor de la pérdida mínimo 2 SMMLV",
            "tipo": ["Manejo de Dinero"],
        },
        {
            "amparo": "Protección para Depósitos Bancarios",
            "deducible": "10% del valor de la pérdida mínimo 2 SMMLV",
            "tipo": ["Manejo de Dinero"],
        },
        {
            "amparo": "Predios Labores y Operaciones",
            "deducible": "10% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Responsabilidad Civil"],
        },
        {
            "amparo": "Contratistas y Subcontratistas",
            "deducible": "10% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Responsabilidad Civil"],
        },
        {
            "amparo": "Responsabilidad Civil Patronal",
            "deducible": "10% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Responsabilidad Civil"],
        },
        {
            "amparo": "Vehículos Propios y no Propios",
            "deducible": "En exceso del SOAT y RCE autos mínimo 100.000.000/100.000.000/200.000.000 COP",
            "tipo": ["Responsabilidad Civil"],
        },
        {
            "amparo": "Propietarios, Arrendatarios y Poseedores",
            "deducible": "10% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Responsabilidad Civil"],
        },
        {
            "amparo": "Responsabilidad Civil Cruzada",
            "deducible": "10% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Responsabilidad Civil"],
        },
        {
            "amparo": "Responsabilidad Civil Parqueaderos",
            "deducible": "10% del valor de la pérdida mínimo 1 SMMLV",
            "tipo": ["Responsabilidad Civil"],
        },
    ],
}
# amparos_adicionales
amparos_adicionales = [
    {
        "archivo": "Slip Cotización 2500004260 Pyme Segura 10+ (1).pdf",
        "amparos": [
            {
                "amparo": "Predios, labores y operaciones",
                "deducible": "$1.000.000",
                "tipo": ["Responsabilidad Civil", "Incendio"],
            },
            {
                "amparo": "Gastos médicos",
                "deducible": "Sin deducible",
                "tipo": ["Responsabilidad Civil"],
            },
            {
                "amparo": "Gastos de defensa",
                "deducible": "Sin deducible",
                "tipo": ["Responsabilidad Civil"],
            },
            {
                "amparo": "Parqueaderos",
                "deducible": "$1.000.000",
                "tipo": ["Responsabilidad Civil"],
            },
            {
                "amparo": "Viajes al exterior",
                "deducible": "$1.000.000",
                "tipo": ["Responsabilidad Civil"],
            },
            {
                "amparo": "Responsabilidad civil patronal por accidentes de trabajo",
                "deducible": "En exceso Seguridad Social",
                "tipo": ["Responsabilidad Civil"],
            },
            {
                "amparo": "Responsabilidad civil por vehículos propios y no propios",
                "deducible": "En exceso de $100.000.000",
                "tipo": ["Responsabilidad Civil"],
            },
            {
                "amparo": "Responsabilidad civil contratistas y subcontratistas independientes (incluye RCE Cruzada)",
                "deducible": "En exceso de $10.000.000",
                "tipo": ["Responsabilidad Civil"],
            },
            {
                "amparo": "Responsabilidad civil por contaminación accidental",
                "deducible": "$1.000.000",
                "tipo": ["Responsabilidad Civil"],
            },
            {
                "amparo": "RCE bienes bajo cuidado, tenencia y control",
                "deducible": "$1.000.000",
                "tipo": ["Responsabilidad Civil"],
            },
            {
                "amparo": "Daño moral, perjuicios fisiológicos, culpa grave y lucro cesante",
                "deducible": "$1.000.000",
                "tipo": ["Responsabilidad Civil"],
            },
            {
                "amparo": "Clientes y empleados del asegurado",
                "deducible": "$1.000.000",
                "tipo": ["Responsabilidad Civil"],
            },
            {
                "amparo": "RCE ensanches, montajes y obras civiles",
                "deducible": "$1.000.000",
                "tipo": ["Responsabilidad Civil"],
            },
            {
                "amparo": "Hurto (Manejo Global Comercial)",
                "deducible": "10% de la pérdida, mínimo 2 SMMLV",
                "tipo": ["Manejo de Dinero", "Sustracción"],
            },
            {
                "amparo": "Hurto calificado (Manejo Global Comercial)",
                "deducible": "10% de la pérdida, mínimo 2 SMMLV",
                "tipo": ["Manejo de Dinero", "Sustracción"],
            },
            {
                "amparo": "Abuso de confianza (Manejo Global Comercial)",
                "deducible": "10% de la pérdida, mínimo 2 SMMLV",
                "tipo": ["Manejo de Dinero", "Sustracción"],
            },
            {
                "amparo": "Falsedad (Manejo Global Comercial)",
                "deducible": "10% de la pérdida, mínimo 2 SMMLV",
                "tipo": ["Manejo de Dinero"],
            },
            {
                "amparo": "Estafa (Manejo Global Comercial)",
                "deducible": "10% de la pérdida, mínimo 2 SMMLV",
                "tipo": ["Manejo de Dinero"],
            },
            {
                "amparo": "Pérdida o daño material durante Transporte de Valores",
                "deducible": "5% de la pérdida, mínimo 1 SMMLV",
                "tipo": ["Transporte de Valores", "Sustracción"],
            },
        ],
    },
    {
        "archivo": "SLIP TRDM OFICINAS_CAMARA DE COMERCIO.pdf",
        "amparos": [
            {
                "amparo": "Incendio y/o rayo o sus efectos inmediatos como calor y humo",
                "deducible": "15% de la pérdida, mínimo 5 SMMLV",
                "tipo": ["Incendio"],
            },
            {
                "amparo": "Explosión",
                "deducible": "15% de la pérdida, mínimo 5 SMMLV",
                "tipo": ["Incendio"],
            },
            {
                "amparo": "Extensión de Amparos (Huracán, tifón, tornado, ciclón, granizo, vientos fuertes, caída de aeronaves, choque de vehículos terrestres)",
                "deducible": "15% de la pérdida, mínimo 5 SMMLV",
                "tipo": ["Incendio"],
            },
            {
                "amparo": "Inundación, anegación, avalancha, enlodamiento y daños por agua",
                "deducible": "15% de la pérdida, mínimo 5 SMMLV",
                "tipo": ["Incendio"],
            },
            {
                "amparo": "Terremoto, temblor, erupción volcánica, maremoto, marejada y/o tsunami",
                "deducible": "2% del valor asegurable del artículo afectado por el siniestro, mínimo 1 SMMLV",
                "tipo": ["Incendio"],
            },
            {
                "amparo": "Huelga, asonada, motín, conmoción civil o popular, actos mal intencionados de terceros, sabotaje y terrorismo",
                "deducible": "10% del valor de la pérdida, mínimo 1 SMMLV",
                "tipo": ["Incendio"],
            },
            {
                "amparo": "Sustracción con violencia (bienes diferentes a equipos eléctricos y electrónicos)",
                "deducible": "10% del valor de la pérdida, mínimo 1 SMMLV",
                "tipo": ["Sustracción"],
            },
            {
                "amparo": "Sustracción con violencia (dineros dentro de caja fuerte)",
                "deducible": "10% del valor de la pérdida mínimo 1 SMMLV",
                "tipo": ["Sustracción", "Manejo de Dinero"],
            },
            {
                "amparo": "Sustracción con violencia (dineros fuera de caja fuerte)",
                "deducible": "10% del valor de la pérdida mínimo 1 SMMLV",
                "tipo": ["Sustracción", "Transporte de Valores"],
            },
            {
                "amparo": "Rotura de maquinaria",
                "deducible": "20% del valor de la pérdida, mínimo 3 SMMLV",
                "tipo": ["Equipo y Maquinaria"],
            },
            {
                "amparo": "Daño interno y hurto calificado (Equipo Eléctrico y Electrónico)",
                "deducible": "Hurto calificado: 10% del valor de la pérdida, mínimo 1 SMMLV; Daño interno: 20% del valor de la pérdida, mínimo 3 SMMLV",
                "tipo": ["Equipo y Maquinaria", "Sustracción"],
            },
            {
                "amparo": "Hurto simple (equipos fijos de oficina)",
                "deducible": "10% del valor de la pérdida, mínimo 1 SMMLV",
                "tipo": ["Equipo y Maquinaria", "Sustracción"],
            },
            {
                "amparo": "Equipos de cómputo móviles y portátiles (excluye hurto simple)",
                "deducible": "10% del valor de la pérdida, mínimo 1 SMMLV (para hurto); 20% del valor de la pérdida, mínimo 3 SMMLV (para daño)",
                "tipo": ["Equipo y Maquinaria"],
            },
            {
                "amparo": "Amparo automático de nuevos bienes o propiedades",
                "deducible": "15% de la pérdida, mínimo 5 SMMLV",
                "tipo": ["Incendio"],
            },
            {
                "amparo": "Remoción de escombros",
                "deducible": "15% de la pérdida, mínimo 5 SMMLV",
                "tipo": ["Incendio"],
            },
            {
                "amparo": "Propiedad personal de empleados",
                "deducible": "15% de la pérdida, mínimo 5 SMMLV",
                "tipo": ["Incendio"],
            },
            {
                "amparo": "Gastos para la extinción del siniestro",
                "deducible": "15% de la pérdida, mínimo 5 SMMLV",
                "tipo": ["Incendio"],
            },
            {
                "amparo": "Gastos para evitar la propagación del siniestro",
                "deducible": "15% de la pérdida, mínimo 5 SMMLV",
                "tipo": ["Incendio"],
            },
            {
                "amparo": "Gastos para la preservación de bienes",
                "deducible": "15% de la pérdida, mínimo 5 SMMLV",
                "tipo": ["Incendio"],
            },
            {
                "amparo": "Gastos para acelerar la reparación o reemplazo",
                "deducible": "15% de la pérdida, mínimo 5 SMMLV",
                "tipo": ["Incendio"],
            },
            {
                "amparo": "Gastos de viaje y estadía",
                "deducible": "15% de la pérdida, mínimo 5 SMMLV",
                "tipo": ["Incendio"],
            },
            {
                "amparo": "Honorarios de auditores, revisores y contadores",
                "deducible": "15% de la pérdida, mínimo 5 SMMLV",
                "tipo": ["Incendio"],
            },
            {
                "amparo": "Gastos por concepto de horas extras, trabajo nocturno, trabajo en días feriados y flete expreso",
                "deducible": "15% de la pérdida, mínimo 5 SMMLV",
                "tipo": ["Incendio"],
            },
            {
                "amparo": "Gastos por reparaciones provisionales o construcciones transitorias y/o temporales",
                "deducible": "15% de la pérdida, mínimo 5 SMMLV",
                "tipo": ["Incendio"],
            },
            {
                "amparo": "Honorarios profesionales",
                "deducible": "15% de la pérdida, mínimo 5 SMMLV",
                "tipo": ["Incendio"],
            },
            {
                "amparo": "Incendio y/o rayo en aparatos eléctricos",
                "deducible": "20% del valor de la pérdida, mínimo 3 SMMLV",
                "tipo": ["Incendio", "Equipo y Maquinaria"],
            },
            {
                "amparo": "Portadores externos de datos",
                "deducible": "20% del valor de la pérdida, mínimo 3 SMMLV",
                "tipo": ["Equipo y Maquinaria"],
            },
            {
                "amparo": "Gastos para la reposición de documentos",
                "deducible": "15% de la pérdida, mínimo 5 SMMLV",
                "tipo": ["Incendio"],
            },
            {
                "amparo": "Rotura accidental de vidrios",
                "deducible": "Sin deducible",
                "tipo": ["Incendio"],
            },
            {
                "amparo": "Traslados temporales de maquinaria y equipos",
                "deducible": "20% del valor de la pérdida, mínimo 3 SMMLV",
                "tipo": ["Equipo y Maquinaria"],
            },
            {
                "amparo": "Nuevas construcciones y montajes menores",
                "deducible": "15% de la pérdida, mínimo 5 SMMLV",
                "tipo": ["Incendio"],
            },
            {
                "amparo": "Amparo automático de ferias y eventos",
                "deducible": "15% de la pérdida, mínimo 5 SMMLV",
                "tipo": ["Incendio"],
            },
            {
                "amparo": "Daños a calderas y/o aparatos generadores de vapor",
                "deducible": "20% del valor de la pérdida, mínimo 3 SMMLV",
                "tipo": ["Equipo y Maquinaria"],
            },
        ],
    },
]

from typing import TypedDict, List


class PolizaDict(TypedDict):
    interes_asegurado: str
    valor_asegurado: int


class DocAdicionalDict(TypedDict):
    archivo: str
    prima_sin_iva: int
    iva: int
    prima_con_iva: int


class DetalleCobertura(TypedDict):
    interes_asegurado: str
    valor_asegurado: int
    tipo: List[str]


class RiesgoDict(TypedDict):
    ubicacion: str
    detalle_cobertura: List[DetalleCobertura]


class Amparo(TypedDict):
    amparo: str
    deducible: str
    tipo: List[str]


class AmparosDict(TypedDict):
    archivo: str
    amparos: List[Amparo]


def generar_excel_analisis_polizas(
    poliza_actual: List[PolizaDict],
    poliza_renovacion: List[PolizaDict],
    riesgos_actuales: List[RiesgoDict],
    riesgos_renovacion: List[RiesgoDict],
    amparos_actuales: AmparosDict,
    amparos_renovacion: AmparosDict,
    amparos_adicionales: List[AmparosDict],
    output_path="reporte_polizas_riesgos.xlsx",
):
    """
    Genera un archivo Excel con análisis de pólizas replicando la funcionalidad
    del código original de app_structure.py usando los datos de x.py

    Args:
        output_path (str): Ruta donde se guardará el archivo Excel

    Returns:
        str: Ruta del archivo generado
    """
    import pandas as pd
    from io import BytesIO
    from openpyxl.styles import Font, PatternFill, Border, Side, Alignment
    from openpyxl.utils import get_column_letter

    output = BytesIO()

    with pd.ExcelWriter(output, engine="openpyxl") as writer:
        # ===== estilos =====
        header_font = Font(name="Calibri", size=12, bold=True, color="FFFFFF")
        header_fill = PatternFill(
            start_color="2E75B6", end_color="2E75B6", fill_type="solid"
        )
        data_font = Font(name="Calibri", size=11)
        border = Border(
            left=Side(style="thin", color="D0D0D0"),
            right=Side(style="thin", color="D0D0D0"),
            top=Side(style="thin", color="D0D0D0"),
            bottom=Side(style="thin", color="D0D0D0"),
        )
        center_alignment = Alignment(
            horizontal="center", vertical="center", wrap_text=True, shrink_to_fit=True
        )
        currency_alignment = Alignment(
            horizontal="right", vertical="center", wrap_text=True, shrink_to_fit=True
        )
        left_alignment = Alignment(
            horizontal="left", vertical="center", wrap_text=True, shrink_to_fit=True
        )

        def format_worksheet(ws, df, sheet_type):
            ws.insert_rows(1, 2)
            title_cell = ws.cell(row=1, column=1)
            title_cell.value = "CENTRO DE DIAGNOSTICO AUTOMOTOR DE PALMIRA"
            title_cell.font = Font(name="Arial", size=16, bold=True, color="FFFFFF")
            title_cell.fill = PatternFill(
                start_color="1F4E79", end_color="1F4E79", fill_type="solid"
            )
            title_cell.alignment = Alignment(horizontal="center", vertical="center")
            ws.merge_cells(
                start_row=1, start_column=1, end_row=1, end_column=len(df.columns)
            )

            if sheet_type == "polizas":
                label_font = Font(name="Arial", size=14, bold=True, color="FFFFFF")
                label_fill = PatternFill(
                    start_color="4472C4", end_color="4472C4", fill_type="solid"
                )
                for row_num in range(3, ws.max_row + 1):
                    cell_value = ws.cell(row=row_num, column=1).value
                    if cell_value and (
                        "PÓLIZAS ACTUALES" in str(cell_value)
                        or "PÓLIZAS DE RENOVACIÓN" in str(cell_value)
                    ):
                        label_cell = ws.cell(row=row_num, column=1)
                        label_cell.font = label_font
                        label_cell.fill = label_fill
                        label_cell.alignment = Alignment(
                            horizontal="center", vertical="center"
                        )
                        ws.merge_cells(
                            start_row=row_num,
                            start_column=1,
                            end_row=row_num,
                            end_column=len(df.columns),
                        )

            for col_num in range(1, len(df.columns) + 1):
                cell = ws.cell(row=3, column=col_num)
                cell.font = header_font
                cell.fill = header_fill
                cell.border = border
                cell.alignment = center_alignment

            for row_num in range(4, len(df) + 4):
                for col_num in range(1, len(df.columns) + 1):
                    cell = ws.cell(row=row_num, column=col_num)
                    cell.font = data_font
                    cell.border = border
                    col_name = df.columns[col_num - 1]
                    if any(x in col_name.lower() for x in ["valor", "prima", "iva"]):
                        cell.alignment = currency_alignment
                        if isinstance(cell.value, (int, float)):
                            cell.number_format = "$#,##0"
                    elif col_name.lower() == "coberturas":
                        cell.alignment = left_alignment
                    else:
                        cell.alignment = center_alignment

            for col_num in range(1, len(df.columns) + 1):
                column_letter = get_column_letter(col_num)
                col_name = df.columns[col_num - 1]
                max_length = max(
                    len(str(col_name)),
                    len("CENTRO DE DIAGNOSTICO AUTOMOTOR DE PALMIRA")
                    // len(df.columns),
                )
                for row_num in range(4, len(df) + 4):
                    cell_value = str(ws.cell(row=row_num, column=col_num).value or "")
                    max_length = max(max_length, len(cell_value))
                if col_name.lower() == "coberturas":
                    width = 45
                else:
                    width = min(max(max_length + 2, 15), 40)
                ws.column_dimensions[column_letter].width = width

            ws.auto_filter.ref = f"A1:{get_column_letter(len(df.columns))}{len(df) + 1}"
            ws.freeze_panes = "A2"

        # ===== hoja Análisis_Estructurado =====
        intereses_unicos = list(
            set(
                [item["Interés Asegurado"] for item in poliza_actual]
                + [item["Interés Asegurado"] for item in poliza_renovacion]
            )
        )
        valores_actuales = {
            item["Interés Asegurado"]: item["Valor Asegurado"] for item in poliza_actual
        }
        valores_renovacion = {
            item["Interés Asegurado"]: item["Valor Asegurado"]
            for item in poliza_renovacion
        }
        total_actual = sum(valores_actuales.values())
        total_renovacion = sum(valores_renovacion.values())

        coberturas = [
            "Incendio y/o Rayo Edificios",
            "Explosión Mejoras Locativas",
            "Terremoto, temblor Muebles y Enseres",
            "Asonada, motin, conm. Civil/popular huelga Mercancias Fijas",
            "Extension de amparo",
            "Daños por agua, Anegación Dineros",
            "Incendio y/o Rayo en aparatos electricos Equipo Electronico",
        ]

        columnas_analisis = [
            "Coberturas",
            "Interés Asegurado",
            "Valor Asegurado Actual",
            "Valor Asegurado Renovado",
        ]
        intereses_ordenados = sorted(intereses_unicos)
        max_filas = max(len(intereses_ordenados), len(coberturas))

        datos_estructurados = []
        for i in range(max_filas):
            fila = {
                "Coberturas": coberturas[i] if i < len(coberturas) else "",
                "Interés Asegurado": (
                    intereses_ordenados[i] if i < len(intereses_ordenados) else ""
                ),
                "Valor Asegurado Actual": (
                    valores_actuales.get(intereses_ordenados[i], 0)
                    if i < len(intereses_ordenados)
                    else ""
                ),
                "Valor Asegurado Renovado": (
                    valores_renovacion.get(intereses_ordenados[i], 0)
                    if i < len(intereses_ordenados)
                    else ""
                ),
            }
            datos_estructurados.append(fila)

        datos_estructurados.append(
            {
                "Coberturas": "",
                "Interés Asegurado": "TOTAL",
                "Valor Asegurado Actual": total_actual,
                "Valor Asegurado Renovado": total_renovacion,
            }
        )

        # forzar solo columnas definidas
        df_estructurado = pd.DataFrame(datos_estructurados)[columnas_analisis]

        df_estructurado.to_excel(
            writer, sheet_name="Análisis_Estructurado", index=False
        )
        format_worksheet(
            writer.sheets["Análisis_Estructurado"], df_estructurado, "polizas"
        )

        # ===== hoja Polizas_Consolidadas =====
        def crear_hoja_consolidada():
            def procesar_poliza(poliza_data):
                if not poliza_data:
                    return None, None
                intereses_valores = {}
                total_poliza = sum(item["Valor Asegurado"] for item in poliza_data)
                for item in poliza_data:
                    intereses_valores[item["Interés Asegurado"]] = item[
                        "Valor Asegurado"
                    ]
                columnas = list(intereses_valores.keys()) + ["Total Póliza"]
                valores = [f"${valor:,.0f}" for valor in intereses_valores.values()] + [
                    f"${total_poliza:,.0f}"
                ]
                return columnas, valores

            columnas_actuales, valores_actuales = procesar_poliza(poliza_actual)
            columnas_renovacion, valores_renovacion = procesar_poliza(poliza_renovacion)

            datos_consolidados = []
            if columnas_actuales and valores_actuales:
                datos_consolidados.append(
                    ["PÓLIZAS ACTUALES"] + [""] * (len(columnas_actuales) - 1)
                )
                datos_consolidados.append(columnas_actuales)
                datos_consolidados.append(valores_actuales)
                datos_consolidados.append([""] * len(columnas_actuales))

            if columnas_renovacion and valores_renovacion:
                max_cols = max(
                    (len(columnas_actuales) if columnas_actuales else 0),
                    len(columnas_renovacion),
                )
                datos_consolidados.append(
                    ["PÓLIZAS DE RENOVACIÓN"] + [""] * (max_cols - 1)
                )
                columnas_renovacion_ajustadas = columnas_renovacion + [""] * (
                    max_cols - len(columnas_renovacion)
                )
                valores_renovacion_ajustados = valores_renovacion + [""] * (
                    max_cols - len(valores_renovacion)
                )
                datos_consolidados.append(columnas_renovacion_ajustadas)
                datos_consolidados.append(valores_renovacion_ajustados)

            if datos_consolidados:
                max_cols = max(len(fila) for fila in datos_consolidados)
                for i, fila in enumerate(datos_consolidados):
                    if len(fila) < max_cols:
                        datos_consolidados[i] = fila + [""] * (max_cols - len(fila))
                columnas_genericas = [f"Columna_{i+1}" for i in range(max_cols)]
                df_consolidado = pd.DataFrame(
                    datos_consolidados, columns=columnas_genericas
                )
                df_consolidado.to_excel(
                    writer, sheet_name="Polizas_Consolidadas", index=False, header=False
                )
                format_worksheet(
                    writer.sheets["Polizas_Consolidadas"], df_consolidado, "polizas"
                )

        crear_hoja_consolidada()

        # ===== hoja Amparos (tercera hoja) =====
        def crear_hoja_amparos():
            # Generar la tabla unificada de amparos basada en la imagen de referencia
            datos_amparos = []

            # Agregar secciones basadas en tipo de amparo
            tipos_encontrados = set()

            # Procesar amparos actuales
            for amp in amparos_actuales["amparos"]:
                tipos = amp["tipo"] if isinstance(amp["tipo"], list) else [amp["tipo"]]
                for t in tipos:
                    tipos_encontrados.add(t)

            # Procesar amparos renovación
            for amp in amparos_renovacion["amparos"]:
                tipos = amp["tipo"] if isinstance(amp["tipo"], list) else [amp["tipo"]]
                for t in tipos:
                    tipos_encontrados.add(t)

            # Procesar amparos adicionales
            for doc in amparos_adicionales:
                for amp in doc["amparos"]:
                    tipos = amp["tipo"] if isinstance(amp["tipo"], list) else [amp["tipo"]]
                    for t in tipos:
                        tipos_encontrados.add(t)

            # Ordenar tipos para crear secciones consistentes
            tipos_ordenados = sorted(tipos_encontrados)

            # Crear estructura basada en la imagen de referencia
            amparos_unicos = []
            amparos_vistos = set()

            # Recopilar todos los amparos únicos
            for amp in amparos_actuales["amparos"]:
                if amp["amparo"] not in amparos_vistos:
                    amparos_unicos.append(amp)
                    amparos_vistos.add(amp["amparo"])

            for amp in amparos_renovacion["amparos"]:
                if amp["amparo"] not in amparos_vistos:
                    amparos_unicos.append(amp)
                    amparos_vistos.add(amp["amparo"])

            for doc in amparos_adicionales:
                for amp in doc["amparos"]:
                    if amp["amparo"] not in amparos_vistos:
                        amparos_unicos.append(amp)
                        amparos_vistos.add(amp["amparo"])

            # Organizar por tipo (cada amparo puede pertenecer a múltiples tipos)
            amparos_por_tipo = {}
            for amp in amparos_unicos:
                tipos_amp = amp["tipo"] if isinstance(amp["tipo"], list) else [amp["tipo"]]
                for t in tipos_amp:
                    amparos_por_tipo.setdefault(t, []).append(amp)

            # Crear estructura de datos para Excel
            for tipo in tipos_ordenados:
                # Añadir fila de sección (encabezado del tipo)
                datos_amparos.append(
                    {
                        "RAMO": tipo.upper(),
                        "CONDICIONES ACTUALES": "",
                        "ZURICH": "",
                        "AXA": "",
                        "BBVA": "",
                        "_es_seccion": True,
                    }
                )

                # Añadir amparos de este tipo
                if tipo in amparos_por_tipo:
                    for amp in amparos_por_tipo[tipo]:
                        # Buscar deducibles en actuales, renovación y adicionales
                        ded_actual = ""
                        ded_renovacion = ""
                        ded_adicional = ""

                        # Buscar en actuales
                        for a in amparos_actuales["amparos"]:
                            if a["amparo"] == amp["amparo"]:
                                ded_actual = a["deducible"]
                                break

                        # Buscar en renovación
                        for a in amparos_renovacion["amparos"]:
                            if a["amparo"] == amp["amparo"]:
                                ded_renovacion = a["deducible"]
                                break

                        # Buscar en adicionales
                        for doc in amparos_adicionales:
                            for a in doc["amparos"]:
                                if a["amparo"] == amp["amparo"]:
                                    ded_adicional = a["deducible"]
                                    break

                        datos_amparos.append(
                            {
                                "RAMO": amp["amparo"],
                                "CONDICIONES ACTUALES": ded_actual,
                                "CONDICIONES DE RENOVACIÓN": ded_renovacion,
                                **{
                                    doc["archivo"]: (
                                        next(
                                            (
                                                a["deducible"]
                                                for a in doc["amparos"]
                                                if a["amparo"] == amp["amparo"]
                                            ),
                                            "",
                                        )
                                    )
                                    for doc in amparos_adicionales
                                },
                                "_es_seccion": False,
                            }
                        )

            # Crear DataFrame
            # Columnas dinámicas: RAMO, actuales, renovación y un campo por cada archivo adicional
            columnas = [
                "RAMO",
                "CONDICIONES ACTUALES",
                "CONDICIONES DE RENOVACIÓN",
            ] + [doc["archivo"] for doc in amparos_adicionales]
            df_amparos = pd.DataFrame(datos_amparos)[columnas]

            # Escribir a Excel
            df_amparos.to_excel(writer, sheet_name="Amparos", index=False)
            ws = writer.sheets["Amparos"]

            # Formateo especial para la hoja de amparos

            # 1. Insertar filas de título y preparar cabeceras multinivel
            ws.insert_rows(1, 2)

            # 2. Título principal
            title_cell = ws.cell(row=1, column=1)
            title_cell.value = "DEDUCIBLES"
            title_cell.font = Font(name="Calibri", size=16, bold=True, color="FFFFFF")
            title_cell.fill = PatternFill(
                start_color="1F4E79", end_color="1F4E79", fill_type="solid"
            )
            title_cell.alignment = Alignment(horizontal="center", vertical="center")
            ws.merge_cells(
                start_row=1, start_column=1, end_row=1, end_column=len(columnas)
            )

            # 3. Encabezados de grupo (fila 2) y subencabezados (fila 3)
            # RAMO ocupa dos filas
            ws.merge_cells(start_row=2, start_column=1, end_row=3, end_column=1)
            a2 = ws.cell(row=2, column=1)
            a2.value = "RAMO"
            a2.font = Font(name="Calibri", size=11, bold=True, color="FFFFFF")
            a2.fill = PatternFill(
                start_color="305496", end_color="305496", fill_type="solid"
            )
            a2.alignment = Alignment(
                horizontal="center", vertical="center", wrap_text=True
            )
            a2.border = Border(
                left=Side(style="thin", color="000000"),
                right=Side(style="thin", color="000000"),
                top=Side(style="thin", color="000000"),
                bottom=Side(style="thin", color="000000"),
            )

            # CONDICIONES ACTUALES (columna B) con subencabezado dinámico del archivo de actuales
            b2 = ws.cell(row=2, column=2)
            b2.value = "CONDICIONES ACTUALES"
            b2.font = Font(name="Calibri", size=11, bold=True, color="FFFFFF")
            b2.fill = PatternFill(
                start_color="70AD47", end_color="70AD47", fill_type="solid"
            )
            b2.alignment = Alignment(
                horizontal="center", vertical="center", wrap_text=True
            )
            b2.border = Border(
                left=Side(style="thin", color="000000"),
                right=Side(style="thin", color="000000"),
                top=Side(style="thin", color="000000"),
                bottom=Side(style="thin", color="000000"),
            )
            ws.cell(row=3, column=2).value = amparos_actuales.get(
                "archivo", "CONDICIONES ACTUALES"
            )

            # CONDICIONES DE RENOVACIÓN (columna C)
            c2 = ws.cell(row=2, column=3)
            c2.value = "CONDICIONES DE RENOVACIÓN"
            c2.font = Font(name="Calibri", size=11, bold=True, color="FFFFFF")
            c2.fill = PatternFill(
                start_color="2F75B5", end_color="2F75B5", fill_type="solid"
            )
            c2.alignment = Alignment(
                horizontal="center", vertical="center", wrap_text=True
            )
            c2.border = Border(
                left=Side(style="thin", color="000000"),
                right=Side(style="thin", color="000000"),
                top=Side(style="thin", color="000000"),
                bottom=Side(style="thin", color="000000"),
            )
            ws.cell(row=3, column=3).value = amparos_renovacion.get(
                "archivo", "CONDICIONES DE RENOVACIÓN"
            )

            # COTIZACIONES adicionales (desde la columna 4 en adelante)
            if len(columnas) > 3:
                ws.merge_cells(
                    start_row=2, start_column=4, end_row=2, end_column=len(columnas)
                )
                d2 = ws.cell(row=2, column=4)
                d2.value = "ARCHIVOS ADICIONALES"
                d2.font = Font(name="Calibri", size=11, bold=True, color="FFFFFF")
                d2.fill = PatternFill(
                    start_color="404040", end_color="404040", fill_type="solid"
                )
                d2.alignment = Alignment(
                    horizontal="center", vertical="center", wrap_text=True
                )
                d2.border = Border(
                    left=Side(style="thin", color="000000"),
                    right=Side(style="thin", color="000000"),
                    top=Side(style="thin", color="000000"),
                    bottom=Side(style="thin", color="000000"),
                )
                # Subencabezados con nombres reales de archivos
                for idx, nombre_archivo in enumerate(columnas[3:], start=4):
                    ws.cell(row=3, column=idx).value = nombre_archivo

            # 4. Formatear subencabezados de columna (fila 3)
            for col_num in range(1, len(columnas) + 1):
                cell = ws.cell(row=3, column=col_num)
                cell.font = Font(
                    name="Calibri",
                    size=11,
                    bold=True,
                    color="000000" if col_num >= 4 else "FFFFFF",
                )
                fill_map = {
                    1: "305496",  # RAMO
                    2: "A9D08E",  # Actual
                    3: "9DC3E6",  # Renovación
                }
                color = fill_map.get(col_num, "D9D9D9")
                cell.fill = PatternFill(
                    start_color=color, end_color=color, fill_type="solid"
                )
                cell.border = Border(
                    left=Side(style="thin", color="000000"),
                    right=Side(style="thin", color="000000"),
                    top=Side(style="thin", color="000000"),
                    bottom=Side(style="thin", color="000000"),
                )
                cell.alignment = Alignment(
                    horizontal="center", vertical="center", wrap_text=True
                )

            # 4. Formatear datos
            for row_num in range(4, len(df_amparos) + 4):
                fila_datos = datos_amparos[row_num - 4]
                es_seccion = fila_datos.get("_es_seccion", False)

                for col_num in range(1, len(columnas) + 1):
                    cell = ws.cell(row=row_num, column=col_num)

                    if es_seccion:
                        # Formato para filas de sección (tipo de amparo)
                        cell.font = Font(
                            name="Calibri", size=11, bold=True, color="FFFFFF"
                        )
                        cell.fill = PatternFill(
                            start_color="4472C4", end_color="4472C4", fill_type="solid"
                        )
                        cell.alignment = Alignment(
                            horizontal="center", vertical="center", wrap_text=True
                        )

                        # Mergear toda la fila para la sección
                        if col_num == 1:
                            ws.merge_cells(
                                start_row=row_num,
                                start_column=1,
                                end_row=row_num,
                                end_column=len(columnas),
                            )
                    else:
                        # Formato para filas de datos normales
                        cell.font = Font(name="Calibri", size=10)
                        cell.alignment = Alignment(
                            horizontal="left", vertical="center", wrap_text=True
                        )

                    # Bordes para todas las celdas
                    cell.border = Border(
                        left=Side(style="thin", color="000000"),
                        right=Side(style="thin", color="000000"),
                        top=Side(style="thin", color="000000"),
                        bottom=Side(style="thin", color="000000"),
                    )

            # 5. Ajustar anchos de columna
            ws.column_dimensions["A"].width = 50  # RAMO - más ancho para nombres largos
            ws.column_dimensions["B"].width = 30  # CONDICIONES ACTUALES
            ws.column_dimensions["C"].width = 30  # ZURICH
            ws.column_dimensions["D"].width = 30  # AXA
            ws.column_dimensions["E"].width = 30  # BBVA

            # 6. Ajustar altura de filas para mejor legibilidad
            for row_num in range(1, len(df_amparos) + 4):
                ws.row_dimensions[row_num].height = 20

        crear_hoja_amparos()

        # ===== hoja Riesgos (cuarta hoja) =====
        def crear_hoja_riesgos():
            # 1) Normalización de intereses asegurados (para consistencia)
            def normalizar_interes(texto: str) -> str:
                t = (texto or "").strip().lower()
                reemplazos = {
                    "edificio": "Edificio",
                    "muebles y enseres": "Muebles y Enseres",
                    "maquinaria y equipo": "Maquinaria y Equipo",
                    "equipo electrico y electronico": "Equipo Eléctrico y Electrónico",
                    "equipo eléctrico y electrónico": "Equipo Eléctrico y Electrónico",
                    "mercancías": "Mercancías",
                    "mercancias": "Mercancías",
                    "dineros": "Dineros",
                    "equipo movil": "Equipo Móvil",
                    "equipo móvil": "Equipo Móvil",
                    "obras de arte": "Obras de Arte",
                }
                # caso combinado en renovación
                if "+" in t and "muebles" in t and "obras" in t:
                    return "Muebles y Enseres"  # asignamos al rubro principal
                return reemplazos.get(t, texto)

            # 2) Definir columnas a partir de riesgos_actuales (L36-375)
            intereses_cols = sorted(
                {
                    normalizar_interes(det["interes_asegurado"])  # noqa: E501
                    for r in riesgos_actuales
                    for det in r.get("detalle_cobertura", [])
                }
            )

            def pivot_riesgos(dataset):
                filas = []
                for r in dataset:
                    fila = {"Ubicación": r.get("ubicacion", "")}
                    for col in intereses_cols:
                        fila[col] = 0
                    for det in r.get("detalle_cobertura", []):
                        k = normalizar_interes(det.get("interes_asegurado", ""))
                        if k in fila:
                            fila[k] += det.get("valor_asegurado", 0)
                    filas.append(fila)
                # Totales
                tot = {"Ubicación": "TOTAL VALORES"}
                for col in intereses_cols:
                    tot[col] = sum(f[col] for f in filas)
                filas.append(tot)
                return pd.DataFrame(filas, columns=["Ubicación"] + intereses_cols)

            df_actual = pivot_riesgos(riesgos_actuales)
            df_renov = pivot_riesgos(riesgos_renovacion)

            # Escribir ambas tablas en la MISMA hoja, con los mismos encabezados
            start_row = 0
            sheet_name = "Riesgos"

            # Tabla 1: Póliza actual
            df_actual.to_excel(
                writer, sheet_name=sheet_name, index=False, startrow=start_row + 1
            )
            ws = writer.sheets[sheet_name]
            ws.cell(row=start_row + 1, column=1, value="Póliza actual").font = Font(
                name="Arial", size=13, bold=True
            )
            ws.merge_cells(
                start_row=start_row + 1,
                start_column=1,
                end_row=start_row + 1,
                end_column=len(df_actual.columns),
            )

            # Formato encabezados y celdas de la primera tabla
            header_row_1 = start_row + 2
            for col_idx in range(1, len(df_actual.columns) + 1):
                c = ws.cell(row=header_row_1, column=col_idx)
                c.font = header_font
                c.fill = header_fill
                c.border = border
                c.alignment = center_alignment
            for r in range(header_row_1 + 1, header_row_1 + 1 + len(df_actual)):
                for cidx in range(1, len(df_actual.columns) + 1):
                    c = ws.cell(row=r, column=cidx)
                    c.font = data_font
                    c.border = border
                    if cidx == 1:
                        c.alignment = left_alignment
                    else:
                        c.alignment = currency_alignment
                        if isinstance(c.value, (int, float)):
                            c.number_format = "$#,##0"

            # Tabla 2: Póliza de Renovación
            start_row_2 = header_row_1 + len(df_actual) + 2
            df_renov.to_excel(
                writer, sheet_name=sheet_name, index=False, startrow=start_row_2 + 1
            )
            ws.cell(
                row=start_row_2 + 1, column=1, value="Póliza de Renovación"
            ).font = Font(name="Arial", size=13, bold=True)
            ws.merge_cells(
                start_row=start_row_2 + 1,
                start_column=1,
                end_row=start_row_2 + 1,
                end_column=len(df_renov.columns),
            )

            header_row_2 = start_row_2 + 2
            for col_idx in range(1, len(df_renov.columns) + 1):
                c = ws.cell(row=header_row_2, column=col_idx)
                c.font = header_font
                c.fill = header_fill
                c.border = border
                c.alignment = center_alignment
            for r in range(header_row_2 + 1, header_row_2 + 1 + len(df_renov)):
                for cidx in range(1, len(df_renov.columns) + 1):
                    c = ws.cell(row=r, column=cidx)
                    c.font = data_font
                    c.border = border
                    if cidx == 1:
                        c.alignment = left_alignment
                    else:
                        c.alignment = currency_alignment
                        if isinstance(c.value, (int, float)):
                            c.number_format = "$#,##0"

            # Ajuste de anchos para toda la hoja
            for cidx in range(1, len(df_actual.columns) + 1):
                letter = get_column_letter(cidx)
                if cidx == 1:
                    ws.column_dimensions[letter].width = 50
                else:
                    ws.column_dimensions[letter].width = 20

        crear_hoja_riesgos()

    with open(output_path, "wb") as f:
        f.write(output.getvalue())

    print(f"✅ Archivo Excel generado exitosamente: {output_path}")
    return output_path


if __name__ == "__main__":
    generar_excel_analisis_polizas(
        poliza_actual=poliza_actual,
        poliza_renovacion=poliza_renovacion,
        riesgos_actuales=riesgos_actuales,
        riesgos_renovacion=riesgos_renovacion,
        amparos_actuales=amparos_actuales,
        amparos_renovacion=amparos_renovacion,
        amparos_adicionales=amparos_adicionales,
        output_path="loli.xlsx",
    )
